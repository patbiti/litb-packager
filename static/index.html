<!DOCTYPE html>
<html lang="en">
<head>
 <script type="text/javascript" src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="http://libs.baidu.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
  <link href="http://libs.baidu.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">

  <style>
    div.status{
      background:#000;
      color:#FFF;
      font-weight:bold;
      float:left;
      position: relative;
      padding-top:25px;
    }
    div.status:after{
      content: "status";
      position: absolute;
      top: -1px;
      left: -1px;
      padding: 3px 7px;
      font-size: 12px;
      font-weight: bold;
      background-color: #f5f5f5;
      border: 1px solid #ddd;
      color: #9da0a4;
      -webkit-border-radius: 4px 0 4px 0;
      -moz-border-radius: 4px 0 4px 0;
      border-radius: 4px 0 4px 0;
    }
    div.show:after{
      content: "terminal";
    }
    div.email:after{
      content: "email";
    }
  </style>

<script>
  var socket = io.connect(window.location.origin);
</script>
</head>
<body>
  <header>
    <div class="container">
      <div class="page-header">
        <h1>litb-riapackger system</h1>
      </div>
      <p>Bootstrap makes use of certain HTML elements and CSS properties that require the use of the HTML5 doctype. Include it at the beginning of all your projects.</p>
    </div>
  </header>
  <div class="container">
    <ul class="nav nav-tabs">
      <li class="active"><a id="switch" href="#">git switch</a></li>
      
    </ul>
    <div class="switch">
      <p class="text-info">swith the git for ui-test or cc</p>
      <form class="form-search">
        <input type="text" class="input-medium search-query" placeholder="master" name="branch" />
        <button type="button" class="btn">switch</button>
      </form>
    </div>
   
  </div>
  <div class="container">
    <div style="height:400px;">
      <div id="show" style="width:600px;height:400px;overflow-y:scroll;" class="status show"></div>
      <div style="float:left;width:200px;height:400px;text-align:center;border-right:1px solid #FFF;height:400px;" class="status">
        <div id="status_info"></div>
        <div id="status" ></div>
      </div>
    </div>
  </div>


  <script>
    var runningInterval;
    var statusRuning = {
      timer : null,
      start : function(){
        statusRuning.timer = setInterval(function(){
          $('#status').html($('#status').html() == '......' ? '' : $('#status').html() + '.');
        },1000);
      },
      stop : function(){
        clearInterval(statusRuning.timer);
        $('#status').html('');
      }
    }
  //switch branch
    var switchZone = $('.switch');
    switchZone.find('button').click(function(){
      $(this).attr('disabled', true);
      $('#show').html('');
      var info = '<p>command excuting</p>';
      $('#status_info').html(info);
      statusRuning.start();
      var inputVal = $.trim(switchZone.find('input').val()) == '' ? 'master' : $.trim(switchZone.find('input').val());
      socket.emit('git_update',{'data':inputVal});
    });

   //commont  on

    socket.on('exit_info', function(data){
      $('button').attr('disabled', false);
      statusRuning.stop();
      var info = '<p>' + data.result  + '</p>';
      info = info + '<p>command ' + data.actionType  + 'excute over</p>';
      $('#status_info').html(info);
    });

    //1
    socket.on('git_renew', function(data){
      $('#show').append(beatify(data.result));
      $('#show').scrollTop($('#show')[0].scrollHeight);
    });

  </script>




<!--test-->
<div>
  <a href="#" id="switch"></a>
</div>
<br/>
<div class="showzone switch">
  <h1>swith the git for ui-test or cc</h1>
  <button type="button" class="btn btn-primary" >switch</button><br/>
  <input type="text" placeholder="master" id="branch"/>
</div>
<button id="choose">choose</button>
<button id="packager">pack</button>
<button id="show_list">Show List</button>

<button id="email">email</button><br/>

<input type="text" placeholder="version:1.3.0" id="version"/>
<input type="text" placeholder="comments" id="comments"/>
<br/>

</body>
<script>
  document.getElementById('choose').onclick = function(){
    socket.emit('choose', { my: 'data1' });
  }
  document.getElementById('packager').onclick = function(){
    this.disabled="disabled";
    document.getElementById('show').innerHTML = '';
    document.getElementById('status').innerHTML = '<p>command packager excuting!</p>'; 
    socket.emit('packager', { my: 'data2' });
  }
  document.getElementById('show_list').onclick = function(){
    document.getElementById('status').innerHTML = '<p>command excuting!</p>'; 
    socket.emit('show', {});
  }
  socket.on('action', function(data){
    document.getElementById('show').innerHTML = document.getElementById('show').innerHTML + '<p>' + data.event + '</p>'; 
  })
  socket.on('show_result', function(data){
    document.getElementById('show').innerHTML =  '<p>' + beatify(data.result) + '</p>'; 
  })

  socket.on('show_result_lasting', function(data){
    document.getElementById('show').innerHTML = document.getElementById('show').innerHTML +   '<p>' + (data.result) + '</p>'; 
  })
  socket.on('file_list', function(data){
    var list = data.result;
    var htmlArr = [];
    for(i=0;i<list.length;i++){
      if(list[i].indexOf('.tgz')>-1){
        htmlArr.push('<p><label><input type="radio" name="filelist" value="');
        htmlArr.push(list[i]);
        htmlArr.push('"/>');
        htmlArr.push(list[i]);
        htmlArr.push('</label></p>');
      }
    }
    document.getElementById('show').innerHTML = htmlArr.join('');
  })
  function beatify(data){
    return data.replace(/\n/g, "<br />");
  }
  function initMail(){
    
  }
  
  
</script>
</html>